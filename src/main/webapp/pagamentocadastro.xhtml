<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="resources/template/layout.xhtml">

	<ui:define name="navegacao">
		<p:breadCrumb>
		    <p:menuitem value="Dashboard" url="/" />
		    <p:menuitem value="Pagamentos" url="/pagamento.xhtml" />
		    <p:menuitem value="Lançamentos" url="#" />
		</p:breadCrumb>			
	</ui:define>
	
	<ui:define name="titulo">
		<label>Contas a Pagar - Lançamentos</label>
	</ui:define>

	<ui:define name="conteudo">
    	
    	<f:metadata>
    		<f:viewParam name="pagamento" value="#{pagamentoCadastroBean.pagamento}" />
    	</f:metadata>		
		
		<div class="ui-g">	
			<div class="ui-g-12">

				<h:form>
					<p:messages autoUpdate="true" globalOnly="true"/>
					
					<p:focus context="@form" />

					<p:toolbar>
						<f:facet name="left">
							<p:button value="Voltar" outcome="/pagamento.xhtml"/>
							<p:spacer style="width: 10px;"/>
					        <p:commandButton value="Salvar" action="#{pagamentoCadastroBean.salvar()}" update="@form" rendered="#{pagamentoCadastroBean.pagamento.possuiParcelas}"/>
						</f:facet>
					</p:toolbar>
					
					<p:panelGrid columns="3" styleClass="painel" columnClasses="rotulo, campo, mensagem">
						<p:outputLabel value="Emissão" for="dataEmissao"/>
						<p:calendar id="dataEmissao" value="#{pagamentoCadastroBean.pagamento.emissao}" pattern="dd/MM/yyyy" mask="true" showOn="button" >
							<f:convertDateTime pattern="dd/MM/yyyy" type="date"/>
						</p:calendar>
						<p:message for="dataEmissao"/>
					
						<p:outputLabel value="Setor" for="setor"/>
				        <p:selectOneMenu id="setor" value="#{pagamentoCadastroBean.pagamento.setor}" lazy="true" style="width: 95%">
				            <f:selectItem itemLabel="Selecione um setor..." noSelectionOption="true" />
				            <f:selectItems value="#{pagamentoCadastroBean.setores}" var="setor" itemLabel="#{setor.descricao}" itemValue="#{setor}"  />
				        </p:selectOneMenu>						
				        <p:message for="setor"/>
					
						<p:outputLabel value="Conta" for="conta"/>
				        <p:selectOneMenu id="conta" value="#{pagamentoCadastroBean.pagamento.conta}" lazy="true" style="width: 95%">
				            <f:selectItem itemLabel="Selecione uma conta..." itemValue="" />
				            <f:selectItems value="#{pagamentoCadastroBean.contas}" var="conta" itemLabel="#{conta.descricao}" itemValue="#{conta}"  />
				        </p:selectOneMenu>						
						<p:message for="conta"/>

						<p:outputLabel value="Fornecedor" for="fornecedor"/>
				        <p:selectOneMenu id="fornecedor" value="#{pagamentoCadastroBean.pagamento.fornecedor}" lazy="true" style="width: 95%">
				            <f:selectItem itemLabel="Selecione um fornecedor..." itemValue="" />
				            <f:selectItems value="#{pagamentoCadastroBean.fornecedores}" var="fornecedor" itemLabel="#{fornecedor.razaoSocial}" itemValue="#{fornecedor}"  />
				        </p:selectOneMenu>						
						<p:message for="fornecedor"/>
					
						<p:outputLabel value="Documento" for="documento"/>
						<p:inputText id="documento" value="#{pagamentoCadastroBean.pagamento.documento}"/>
						<p:message for="documento"/>
					
						<p:outputLabel value="Histórico" for="historico"/>
						<p:inputText id="historico" value="#{pagamentoCadastroBean.pagamento.historico}" style="width: 95%" />
						<p:message for="historico"/>
					
						<p:outputLabel value="Total" for="total"/>
						<p:inputText id="total" value="#{pagamentoCadastroBean.pagamento.total}" disabled="true">
								<f:convertNumber type="currency"/>
						</p:inputText>
						<p:message for="total"/>
					
						<p:outputLabel value="Total a Pagar" for="totalAPagar"/>
						<p:inputText id="totalAPagar" value="#{pagamentoCadastroBean.pagamento.total - pagamentoCadastroBean.pagamento.totalPg}" disabled="true">
							<f:convertNumber type="currency"/>
						</p:inputText>
						<p:message for="totalAPagar"/>
					
						<p:outputLabel value="Situação" for="situacao"/>
						<p:inputText id="situacao" value="#{pagamentoCadastroBean.pagamento.situacao.descricao}" disabled="true"/>
						<p:message for="situacao"/>
					
					</p:panelGrid>
					
					<p:panelGrid columns="1">
						<p:toolbar>
							<f:facet name="left">
								<p:button value="Nova Parcela" icon="fa fa-plus" outcome="pagamentocadastroparcela">
									<f:param name="pagamento" value="#{pagamentoCadastroBean.pagamento.idPagamento}"/>
								</p:button>
							</f:facet>
						</p:toolbar>
					
				        <p:dataTable value="#{pagamentoCadastroBean.pagamento.parcelas}" 
							        	var="parcela" 
							        	id="tabelaDetalhe" 
							        	emptyMessage="Nenhum registro encontrado" 
										rows="8" paginator="true" paginatorPosition="bottom">
							
				        	<p:column headerText="Parcela" >
				        		<h:outputText value="#{parcela.parcela}"/>
				        	</p:column>

				        	<p:column headerText="Vencimento" width="10%">
				        		<h:outputText value="#{parcela.vencimento}">
				        			<f:convertDateTime pattern="dd/MM/yyyy"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="Valor" >
				        		<h:outputText value="#{parcela.valor}">
				        			<f:convertNumber type="currency"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="Desconto" >
				        		<h:outputText value="#{parcela.desconto}">
				        			<f:convertNumber type="currency"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="Juros" >
				        		<h:outputText value="#{parcela.juros}">
				        			<f:convertNumber type="currency"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="Mora" >
				        		<h:outputText value="#{parcela.mora}">
				        			<f:convertNumber type="currency"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="Outros" >
				        		<h:outputText value="#{parcela.outros}">
				        			<f:convertNumber type="currency"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="Total" >
				        		<h:outputText value="#{parcela.totalParcela}">
				        			<f:convertNumber type="currency"/>
				        		</h:outputText>
				        	</p:column>

				        	<p:column headerText="Situação">
				        		<h:outputText value="#{parcela.situacao.descricao}"/>
				        	</p:column>
				        	
							<p:column width="10%">
								<f:facet name="header">Operações</f:facet>
								<p:button title="Alterar" icon="fa fa-pencil" outcome="pagamentocadastroparcela">
									<f:param name="parcela" value="#{parcela.idParcela}"/>
								</p:button>

								<p:commandButton title="Excluir" icon="fa fa-trash" 
										update="@form" process="@this" 
										action="#{pagamentoCadastroBean.excluirParcela(parcela)}">
									<p:confirm header="Confirma exclusão" message="Confirma a excusão de #{contato.contato}" icon="ui-icon-alert" />							
								</p:commandButton>
							</p:column>
							
				        </p:dataTable>
	
					    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
					        <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
					        <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
					    </p:confirmDialog>
					    
				    </p:panelGrid>
					
					
				</h:form>

			</div>
		</div>
	</ui:define>

	<ui:define name="pagina">Lançamento de Contas a Pagar</ui:define>
</ui:composition>

</html>
